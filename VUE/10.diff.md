# Diff

深度优先,同层比较

## diff 的时机

当组件被创建时，以及依赖的属性或数据变化时,会运行一个函数,该函数会做两件事

1. 运行\_rander 函数生成一个新虚拟 DOM 树(VNode Tree),这个对象包含了组件的属性和数据的最新值
2. 运行\_update 函数,这个函数会将新生成的虚拟 DOM 树与老的虚拟 DOM 树进行比较,并更新 DOM 树

```javascript
function Vue() {
  // ...
  var updateComponent = function () {
    this._update(this._render());
  };
  new Watcher(updateComponent);
  // ...
}
```

diff 算法就运行在\_update 函数中

## \_update 函数在干嘛

1. 将\_vnode 属性重新赋值,让它指向新树
2. 判断旧树是否存在
   1. 不存在,直接将新树插入到页面中
   2. 存在,则通过 patch 函数将新树与旧树进行比较,并更新 DOM 树

## patch 函数的对比流程

1. **类型判断与简单属性比较**：

   - 首先，判断新旧节点是否为同一类型（例如都是元素节点、文本节点或组件节点等）。
   - 如果节点类型不同，则直接替换整个 DOM 节点；若类型相同，则进一步比较它们的属性，包括标签名、类名、样式、事件监听器等，并对发生变化的属性进行更新。

2. **元素节点子节点的对比**：

   - 如果是元素节点，继续比较其子节点列表。
   - Vue 采用了智能优化策略，对于子节点列表采用**动态编程算法**，通过同时遍历新旧子节点数组来找出最优的移动、插入和删除操作，而不是简单的深度优先搜索（DFS）。
