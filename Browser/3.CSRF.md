# CSRF
跨站请求伪造（Cross-Site Request Forgery, CSRF）是另一种常见的Web应用程序安全漏洞，它允许攻击者利用用户的登录状态，在用户不知情的情况下执行操作。
1. CSRF 的定义
CSRF 攻击通过恶意网站或电子邮件中的链接、表单等方式，诱导已登录目标网站的用户触发一个请求到目标站点。由于浏览器会自动携带用户在目标站点的有效会话Cookie，因此这个请求会被服务器视为合法，并执行相应的操作。
2. CSRF 攻击的原理
当用户访问了包含恶意请求的页面时，浏览器会自动添加所有与目标网站相关的Cookie到该请求头中。如果这是一个状态改变的操作（如转账、删除数据等），攻击者就能借助用户的权限来完成这些操作而不被用户察觉。
3. CSRF 的危害
攻击者可以利用受害者的身份执行对目标网站的非授权操作，例如：修改账户设置、发送垃圾邮件、进行非法转账等敏感操作。
4. 防御 CSRF 的方法
同步令牌（Synchronizer Token Pattern）：服务器为每个需要保护的请求生成一个随机的、一次性使用的令牌，将其存储在服务器端并同时附带在客户端表单中。当接收到请求时，服务器会验证这个令牌是否匹配预期值，不匹配则拒绝执行操作。

双重 Cookie 检查：服务器不仅检查请求中包含的Session标识，还检查一个专门用于防止CSRF的隐藏Cookie是否存在且内容正确。

Custom HTTP Headers：自定义HTTP头部信息，要求浏览器发起的请求中包含特定且难以预测的头部字段，攻击者通常无法通过HTML注入模拟这些头部信息。

POST 而不是 GET：尽管不能完全阻止CSRF攻击，但尽量将重要操作设计为POST请求而不是GET，因为GET请求容易被嵌入到img标签或者链接中，而POST则相对更难。

使用CORS（跨源资源共享）策略：限制哪些域可以向你的应用发起跨域请求，可以减少CSRF的风险，但这并不能作为唯一的防护手段，因为它并不适用于同源请求。

5. 框架和库的支持
许多现代Web框架和库提供了内置的CSRF防护机制，比如Django、Rails、Spring Security等都支持生成和验证CSRF token以防止此类攻击。
总之，防范CSRF攻击需要开发者在设计和实现Web应用时充分考虑安全性，采用合适的防护措施确保用户不会在不知情的情况下执行重要的状态更改操作。